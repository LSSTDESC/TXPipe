Cluster Files
=============

The TXPipe core is focused on 3x2pt (lensing + clustering) measurements, but the CLMM packages runs of its data selection steps within TXPipe. The files these stages use are described here.


Cluster Catalogs
----------------

Cluster catalogs are generated by cluster-finding algorithms like RedMapper (which are currently not run within TXPipe). They are an input to the stages in `txpipe/extensions/clmm`.

==========  =============  ==========  =========
Group       Name           Kind        Meaning
==========  =============  ==========  =========
clusters    cluster_id     int64
clusters    ra             float64
clusters    dec            float64
clusters    redshift       float64
clusters    redshift_err   float64
clusters    richness       float64
clusters    richness_err   float64
clusters    scaleval       float64
==========  =============  ==========  =========


Cluster Shear Catalogs
----------------------

The cluster shear catalog is generated in the `CLClusterShearCatalogs` stage. For each cluster, it lists the source galaxies which are nearby and behind that cluster. It records both the index into the original shear catalog, and the shear values rotated into the cluster frame, plus a distance from the cluster and a weight.

The cluster shear catalog structure is a little complicated - it contains a table of clusters, and for each of those clusters, and index into another table of source galaxies. The columns in the cluster shear catalog are:

The `catalog` group is a list of clusters, matching the order in the cluster catalog which this came from.

The `index` group is a list of galaxies around clusters.

=======  ========================  ==========  =========
Group    Name                      Kind        Meaning
=======  ========================  ==========  =========
catalog  cluster_id                1D int64    The ID number from a cluster in the cluster catalog.
catalog  cluster_sample_count      1D int32    The row in the `index` catalog where galaxies around this cluster start.
catalog  cluster_sample_start      1D int32    The number of rows in the `index` catalog for galaxies around this cluster.
catalog  cluster_theta_max_arcmin  1D float64  The maximum distance from the cluster center of included galaxies.
index    cluster_index             1D int64    The row in the `catalog` group where the cluster this galaxy is around is.
index    source_index              1D int64    The row of this galaxy in the original shear catalog.
index    cross_comp                1D float64  The cross component of the shear, rotated into the cluster frame.
index    tangential_comp           1D float64  The tangential component of the shear, rotated into the cluster frame.
index    distance_arcmin           1D float64  The distance from the cluster center to this galaxy in arcminutes.
index    weight                    1D float64  The weight assigned to this galaxy for this cluster.
=======  ========================  ==========  =========
